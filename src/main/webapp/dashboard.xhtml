<?xml version="1.0" encoding="UTF-8"?>

<ui:composition template="template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:sec="http://www.springframework.org/security/tags">

    <ui:define name="title">Dashboard</ui:define>

    <ui:define name="content">
        <h1 id="header">Dashboard</h1>
        <p>Yep, you are inside!</p>
  
        <sec:authorize ifAllGranted="ROLE_ADMIN">
            <a href="/createUser.xhtml">Create User</a>
        </sec:authorize>
        
        <ui:fragment rendered="#{dashboardBean.teamMembers.size() != 0}">    
            <h2>Your teams</h2>          
            <c:forEach items="#{dashboardBean.teamMembers}" var="teamMember">
                <div style="border:1px black solid; margin:10px; padding:10px;">
                    <h3>#{teamMember.team.course.name} (team #{teamMember.team.id})</h3>
                    <h4>Submitted artifacts</h4>
                    <c:forEach items="#{teamMember.team.artifacts}" var="artifact">
                        <h:form>
                            <p:commandLink value="#{artifact.name}" ajax="false">
                                <p:fileDownload value="#{reviewartifactBean.getArtifactFile(artifact.id)}" />
                            </p:commandLink>
                        </h:form>
                        (Submitted by #{artifact.submitter.user.name})
                    </c:forEach>
                    <a href="/submitArtifact.xhtml?teamId=#{teamMember.team.id}">Submit artifact</a>
                    <ui:fragment rendered="#{reviewartifactBean.getUnreviewedReviewAssignments(teamMember).size() != 0}">    
                        <h4>Artifacts to review</h4>
                        <ul>
                        <c:forEach items="#{reviewartifactBean.getUnreviewedReviewAssignments(teamMember)}" var="reviewAssignment">
                            <li><a href="/reviewArtifact.xhtml?reviewAssignmentId=#{reviewAssignment.id}">#{reviewAssignment.rpmAssignment.artifact.name}</a></li>
                        </c:forEach>
                        </ul>
                    </ui:fragment>
                    <ui:fragment rendered="#{not empty teamMember.activeRPM}">    
                        <h4>You are RPM of team #{teamMember.activeRPM.team.id}</h4>
                        <ui:fragment rendered="#{dashboardBean.getUnassignedArtifacts(teamMember.activeRPM).size() != 0}">
                            <p>Unassigned artifacts:</p>
                            <ul>
                                <c:forEach items="#{dashboardBean.getUnassignedArtifacts(teamMember.activeRPM)}" var="artifact">
                                    <li><a href="/assignArtifact.xhtml?artifactId=#{artifact.id}&amp;teamMemberId=#{teamMember.id}">#{artifact.name}</a></li>
                                </c:forEach>
                            </ul>
                        </ui:fragment>
                    </ui:fragment>
                </div>
            </c:forEach>
        </ui:fragment>

        
        <a href="/createTeam.xhtml">Create Team</a>
        <a href="/j_spring_security_logout">Logout</a>
    </ui:define>
</ui:composition>
